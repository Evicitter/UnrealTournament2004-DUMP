## Описание

Инструмент для создания псевдо-динамических теней в UT2004. Последняя редакция 15 сентября 2006 года.

## Установка

Добавить в UT2004.ini -> [Editor.EditorEngine]. EditPackages=EvilEm_RTS_Tool<br>
НАПРИМЕР:<br>
EditPackages=UTV2004c<br>
EditPackages=UTV2004s<br>
**EditPackages=EvilEm_RTS_Tool**<br>
CutdownPackages=Core<br>
CutdownPackages=Editor<br>
<br>
Или в самый конец секции EditorEngine.<br>
CutdownPackages=XWebAdmin<br>
CutdownPackages=XVoting<br>
**EditPackages=EvilEm_RTS_Tool**<br>
<br>
Запустить "System\UCC.exe make"<br>

## Пример создания

С самого начала необходимо подготовить карту. Добавить один *Brush*, в котором мы соответственно будем бегать. Расставить статик меши или ещё BSP.<br>
Затем создать любой актор, Класс *Light* не подойдёт он статический, для динамики можно использовать *TriggerLight*.<br>
Его можно привязать к какому-либо муверу через *AttachTag* (Также не забудем поставить у него *bInitiallyOn* на true, чтоб свет лампы был виден при старте игры).<br>
Но самое главное необходимо указать у этого актора соответствующее имя *Tag*, например ‘Base_Room’, далее у ститиков *Display->bShadowCast* поставим на false.<br>
И после чего выделяем Акторы но не все подряд, а только те что относятся к геометрии (Brush, StaticMeshActor и т.д.) плюс саму лампочку,
дублируем это всё и перетаскиваем на свободное пространство куда нибудь подальше (будем называть это теневой комнатой).<br>
Теперь работаем с этими дублированными акторами. Далее в нашей дублированной лампочки зададим новое имя *Tag*, например, ‘Shadow_Room’.<br>
У всех брашей необходимо поставить серую текстуру “Engine.GrayTexture”, это будет означать что проектор эти места не будет проецировать.<br>
Брашу в SurfaceProperties следует поставить галочку *Unlit*. Дальше перекрашиваем статики тоже в серый цвет при помощи *Display->Skins*,<br>
и в итоги они все станут чёрными, потом по вкусу добавляем *AmbientGlow* - что будет означать интенсивность теней.<br>
Чем ближе к серому, тем тени становиться меньше видимыми. Затем ПКМ кликнем по *EvilEm_RTS_Tool* на панели созданий брашей.<br>
В параметр *InShadowActorTag* указываем *Tag* ‘Shadow_Room’ второй лампочки (№2), которая находится в теневой комнате.<br>
*OutShadowActorTag* указываем *Tag* ‘Base_Room’, лампочка (№1) которая находится, в нормальной комнате.<br>
Это означает что вокруг лампочки №2 создастся 6 проекторов, которые будут снимать окружение теневой комнаты, и создадутся 6 проекторов вокруг лампочки №1.<br>
и которые будут проецировать то, что снимают проекторы лампочки №2. Все серые цвета игнорируются проектором, а все остальные оттенки проецируются в обычной комнате,<br>
что создаёт иллюзию теней.<br>
**ПРИМЕЧАНИЕ**: Если всё сделано правильно, то появиться сообщение "Operation is successfully completed.".<br>

## Некоторые проблемы

1)	Если встать ровно между источником, и каким ни будь статиком, то тень статика будет накладываться на персонажа. Причина в том, что у источника стоят обычные проекторы, и они заполняют своей проекцией все, что встречается на пути.
2)	Проблема наложения проекции (теней) на статики по причине самого движка. Плохо работает с *DynamicProjector*’ом. На статиках появляются всякие артефакты.
3)	Проблема с коронами, если они попадают в радиус проекции то они начинают мерцать, не видимо для человеческого глаза. По причине *ShadowRefrashRate* (Обновление теней). По не известной причине он включает и выключает короны.
Увидеть мерцание можно при уменьшения значения *ShadowRefrashRate*.
4)	Если комната создана из одного гигантского браша, то на его сторонах могут появиться всякие артефакты типа искажения теней и т.д. Что бы этого избежать комнату надо строить из несколько умеренно больших брашей.
5)	*UnrealEd* не видит только что созданные *ScriptedTexture* в *MyLevel*. Для того чтоб их увидеть нужно сохранить карту и перезапустить UnrealEd.

## ПАРАМЕТРЫ

**ShadowResolution** – Параметр, отвечающий за размер *ScriptedTexture* по ширине, и по высоте.<br>
**InShadowActorTag** – Имя *Tag* актора возле которого появятся проекторы играющие роль камер.<br>
**OutShadowActorTag** – Имя *Tag* актора возле которого появятся проекторы, играющие роль наложения теней.<br>
**ShadowRefreshRate** – Кол-во обновлений кадра в секунду у *ScriptedTexture*.<br>
**OutMaxTraceDistance** – Это установка *MaxTraceDistance* у проекторов накладывающих тень.<br>
**OutProjectorsDrawScale** – Размер и дистанция между проекторами накладывающие тень.<br>
**bUseGroupingActors** – Использовать группирование акторов при их создании.<br>
<br>
Для того чтобы увидеть группы, необходимо открыть броузер групп (Group Browser), затем *View->Refresh*.<br>
Появятся группы, имена которых будут похожи на имена *InShadowActorTag* и *OutShadowActorTag*.<br>
В группу *InShadowActorTag* будут включены проекторы, сам Актор возле которого они появятся, и *CameraTextureClient’ы*.<br>
В группу *OutShadowActorTag* будут включены только проекторы, отбрасывающие тень. Затем для отображения акторов группы, необходимо включить галочки.<br>
<br>
**ProjController** Дополнительные параметры.<br>
Далее показаны параметры контроля, которые не требуют большого внимания.<br>
**bAutoFillMaxTraceDistance** – Авто заполнение *MaxTraceDistance* у проекторов накладывающих тень по одному из ниже написанных методов, при этом параметр *OutMaxTraceDistance* не будет учитываться.<br>
**ПРИМЕЧАНИЕ**: *bAutoFillMaxTraceDistance* плохо работает.<br>
Во-первых нежелательно применять в пространстве где слишком сложная геометрия.<br>
Во-вторых пока авто трассировка не берёт в расчёт угол обзора.<br>
**MethodOfDistance** – Методы авто заполнения дистанции, трассировки до ближайшей геометрии карты, применяется ко всем проекторам, отбрасывающие тень.<br>
1) **ThisProj** – У каждого проектора будет своя дистанция.
2) **Min** – Примениться самая минимальная дистанция трассировки.
3) **Max** – Примениться самая максимальная дистанция трассировки.

**ObjCommand** Параметр команды.<br>
1) **CreateProj** – Стандартная команда создающая проекторы.
2) **UpdateActors** – Обновляет параметры проекторов, которые отбрасывают тень. Это можно использовать например для отладки.
3) **DeleteAllProj** – Удалит все проекторы и *CameraTextureClient*’ы, которые были созданы последними и только этим инструментом (также удаляет группы).

**StaticMeshDublicate** Дополнительные параметры.<br>
Далее рассматриваются параметры которые связанны с дублированием StaticMeshActor’ов относительно проекторов накладывающих тень.<br>
**bAutoCreateStaticMeshes** – Включение автоматического дублирования статиков.<br>
**MethodOfFinding** – Метод нахождения статиков.
1) **FM_Tag** – найдёт статики по их параметру *Tag*, указанном в *TagStaticMesh*.
2) **FM_Radius** – найдёт статики по указанному радиусу *RadiusToStaticMesh*.
<br>

## ФИЧИ

1)	**bAutoFillMaxTraceDistance** –  В текущей версии корректно не работает. Предполагалось ещё сделать мульти авто трассирование.
2)	Просмотр результата в реальном времени. Это что-то вроде *UpdateFrame* – по идее должен запустить код *ScriptedTexture* прямо в *UnrealEd*. Проблема: довольно трудно заставить работать *Tick()* в проекторе.

Автор идеи: **James 'Solid Snake' Tan**<br>
Разработка и идея инструмента: **EVILemitter**<br>
Разработка демо-сцены: **KrowNET**<br>
